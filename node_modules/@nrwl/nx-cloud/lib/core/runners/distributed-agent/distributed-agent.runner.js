const a5_0x119f=['length','Fetching\x20tasks...','next','End\x20all\x20currently\x20running\x20agents,\x20run\x20\x22npx\x20nx-cloud\x20clean-up-agents\x22,\x20and\x20try\x20again.','value','child_process','/lockfiles','completeRunGroupWithError','exit','floor','inherit','retryDuring:\x20','getTime','then','cacheDirectory','random','Executing:\x20\x27','We\x20have\x20detected\x20other\x20agents\x20running\x20in\x20this\x20workspace.\x20This\x20can\x20cause\x20unexpected\x20behavior.','getRunGroup','readFileSync','taskId','.lock','parse','--configuration=','status','Critical\x20Error\x20in\x20Agent:\x20\x22','target','tasks','env','strip-json-comments','DISTRIBUTED_TASK_EXECUTION_INTERNAL_ERROR_STATUS_CODE','map','existsSync','../../../utilities/create-no-new-messages-timeout','params','Waiter','npx\x20nx\x20run-many\x20--target=','startAgent','createNoNewMessagesTimeout','Waiting...','executionId:\x20','output','Command\x20execution\x20failed.\x20Tasks\x20hashes\x20haven\x27t\x20been\x20recorded.','reset','push','configuration','API\x20Response','note','\x20--parallel\x20--max-parallel=','./distributed-agent.api','criticalErrorMessage','executionId','Duplicate\x20Agent\x20ID\x20Detected','default','error','tasksRunnerOptions','done','NX_AGENT_NAME','retryDuring','CIRCLECI','true','writeFileSync','@nrwl/workspace/src/utilities/output','../../../utilities/waiter','printRunGroupError','completed:\x20','mkdirSync','../../../utilities/environment','assign','Starting\x20an\x20agent\x20for\x20running\x20Nx\x20tasks','projects','join','VERBOSE_LOGGING','completed','unlinkSync','../../error/print-run-group-error','execSync','If\x20you\x20believe\x20this\x20is\x20the\x20case,\x20run\x20\x22npx\x20nx-cloud\x20clean-up-agents\x22.','number\x20of\x20tasks:\x20','toString','completedStatusCode','throw','__awaiter','message','This\x20can\x20also\x20be\x20a\x20false\x20positive\x20caused\x20by\x20agents\x20that\x20did\x20not\x20shut\x20down\x20correctly.','apply','Distributed\x20Execution\x20Terminated','defineProperty','We\x20have\x20detected\x20another\x20agent\x20with\x20this\x20ID\x20running\x20in\x20this\x20workspace.\x20This\x20should\x20not\x20happen.','forEach','warn','Error:'];(function(_0x563008,_0x119fbd){const _0x59472b=function(_0x3d1a19){while(--_0x3d1a19){_0x563008['push'](_0x563008['shift']());}};_0x59472b(++_0x119fbd);}(a5_0x119f,0x1ce));const a5_0x5947=function(_0x563008,_0x119fbd){_0x563008=_0x563008-0x0;let _0x59472b=a5_0x119f[_0x563008];return _0x59472b;};'use strict';var __awaiter=this&&this[a5_0x5947('0x50')]||function(_0x4f660e,_0x493129,_0x11c8bd,_0x19c896){function _0x4c67db(_0xcc10da){return _0xcc10da instanceof _0x11c8bd?_0xcc10da:new _0x11c8bd(function(_0x6318ab){_0x6318ab(_0xcc10da);});}return new(_0x11c8bd||(_0x11c8bd=Promise))(function(_0x1233d0,_0x132f9d){function _0x2c8feb(_0x4e3996){try{_0xba2055(_0x19c896[a5_0x5947('0x0')](_0x4e3996));}catch(_0x36f745){_0x132f9d(_0x36f745);}}function _0x2b331a(_0x306379){try{_0xba2055(_0x19c896[a5_0x5947('0x4f')](_0x306379));}catch(_0x8adf9b){_0x132f9d(_0x8adf9b);}}function _0xba2055(_0x5502a6){_0x5502a6[a5_0x5947('0x36')]?_0x1233d0(_0x5502a6[a5_0x5947('0x2')]):_0x4c67db(_0x5502a6['value'])[a5_0x5947('0xb')](_0x2c8feb,_0x2b331a);}_0xba2055((_0x19c896=_0x19c896[a5_0x5947('0x53')](_0x4f660e,_0x493129||[]))[a5_0x5947('0x0')]());});};Object[a5_0x5947('0x55')](exports,'__esModule',{'value':!![]});exports[a5_0x5947('0x23')]=void 0x0;const output_1=require(a5_0x5947('0x3c'));const child_process_1=require(a5_0x5947('0x3'));const stripJsonComments=require(a5_0x5947('0x1b'));const distributed_agent_api_1=require(a5_0x5947('0x2f'));const waiter_1=require(a5_0x5947('0x3d'));const environment_1=require(a5_0x5947('0x41'));const print_run_group_error_1=require(a5_0x5947('0x49'));const create_no_new_messages_timeout_1=require(a5_0x5947('0x1f'));const fs_1=require('fs');function executeTasks(_0x46b04b,_0x1690ed){return __awaiter(this,void 0x0,void 0x0,function*(){let _0x315820=0x0;let _0x349b40=null;const _0x305e10=create_no_new_messages_timeout_1[a5_0x5947('0x24')]();const _0x4115d3=new waiter_1[(a5_0x5947('0x21'))]();let _0x5ecc5e=[];const _0x2f4d1b=new Date();let _0x463418=![];while(!![]){if(environment_1[a5_0x5947('0x46')]){output_1[a5_0x5947('0x27')][a5_0x5947('0x2d')]({'title':a5_0x5947('0x5b')});}_0x349b40=yield _0x1690ed['tasks'](_0x349b40?_0x349b40[a5_0x5947('0x31')]:null,_0x315820,_0x5ecc5e);if(environment_1[a5_0x5947('0x46')]){output_1[a5_0x5947('0x27')][a5_0x5947('0x2d')]({'title':a5_0x5947('0x2c'),'bodyLines':[a5_0x5947('0x3f')+_0x349b40[a5_0x5947('0x47')],a5_0x5947('0x9')+_0x349b40['retryDuring'],a5_0x5947('0x26')+_0x349b40[a5_0x5947('0x31')],a5_0x5947('0x4c')+_0x349b40[a5_0x5947('0x19')][a5_0x5947('0x5a')],'error:\x20'+_0x349b40[a5_0x5947('0x30')],'maxParallel:\x20'+_0x349b40['maxParallel']]});}if(_0x349b40['criticalErrorMessage']){output_1[a5_0x5947('0x27')][a5_0x5947('0x34')]({'title':a5_0x5947('0x54'),'bodyLines':[a5_0x5947('0x59'),_0x349b40[a5_0x5947('0x30')]]});process[a5_0x5947('0x6')](0x0);}if((_0x349b40===null||_0x349b40===void 0x0?void 0x0:_0x349b40[a5_0x5947('0x38')])&&(_0x349b40===null||_0x349b40===void 0x0?void 0x0:_0x349b40[a5_0x5947('0x38')])!==0x0&&!_0x463418&&new Date()[a5_0x5947('0xa')]()-_0x2f4d1b['getTime']()>_0x349b40[a5_0x5947('0x38')]){yield _0x4115d3['wait']();continue;}if(_0x349b40['completed'])return;_0x305e10(_0x349b40[a5_0x5947('0x19')][a5_0x5947('0x1d')](_0x4fe23a=>_0x4fe23a[a5_0x5947('0x12')])[a5_0x5947('0x45')](''));if(!_0x349b40[a5_0x5947('0x31')]){if(environment_1[a5_0x5947('0x46')]){output_1['output']['note']({'title':a5_0x5947('0x25')});}yield _0x4115d3['wait']();_0x315820=0x0;_0x5ecc5e=[];continue;}_0x4115d3[a5_0x5947('0x29')]();_0x463418=!![];const _0x4eb805=invokeTasksUsingRunMany(_0x46b04b,_0x349b40[a5_0x5947('0x31')],_0x349b40[a5_0x5947('0x19')],_0x349b40['maxParallel']);_0x315820=_0x4eb805[a5_0x5947('0x4e')];_0x5ecc5e=_0x4eb805['completedTasks'];}});}function readCompletedTasks(_0x274a77){try{const _0x47f58b=_0x274a77[a5_0x5947('0xc')]||'./node_modules/.cache/nx';return JSON[a5_0x5947('0x14')](fs_1[a5_0x5947('0x11')](_0x47f58b+'/tasks-hashes')[a5_0x5947('0x4d')]());}catch(_0x45947e){output_1[a5_0x5947('0x27')][a5_0x5947('0x34')]({'title':a5_0x5947('0x28')});return[];}}function invokeTasksUsingRunMany(_0x432121,_0x4ccce6,_0x54f6e5,_0x2cc1a1){let _0x377afc=0x0;const _0x18c0ff=[];for(const _0x39fe1e of groupByTarget(_0x54f6e5)){const _0x45212c=_0x39fe1e['configuration']?a5_0x5947('0x15')+_0x39fe1e[a5_0x5947('0x2b')]:'';const _0x134f72=_0x2cc1a1>0x1?a5_0x5947('0x2e')+_0x2cc1a1:'';const _0x2e4f88=a5_0x5947('0x22')+_0x39fe1e['target']+'\x20'+_0x45212c+'\x20--projects='+_0x39fe1e['projects'][a5_0x5947('0x45')](',')+'\x20'+_0x39fe1e[a5_0x5947('0x20')]+_0x134f72;if(environment_1[a5_0x5947('0x46')]){output_1[a5_0x5947('0x27')]['note']({'title':a5_0x5947('0xe')+_0x2e4f88+'\x27'});}try{child_process_1[a5_0x5947('0x4a')](_0x2e4f88,{'stdio':[a5_0x5947('0x8'),'inherit',a5_0x5947('0x8')],'env':Object[a5_0x5947('0x42')](Object[a5_0x5947('0x42')]({},process[a5_0x5947('0x1a')]),{'NX_CACHE_FAILURES':a5_0x5947('0x3a'),'NX_CLOUD_DISTRIBUTED_EXECUTION_ID':_0x4ccce6})});}catch(_0x4000b4){if(_0x4000b4[a5_0x5947('0x16')]===environment_1[a5_0x5947('0x1c')]){throw _0x4000b4;}else{_0x377afc=0x1;}}finally{_0x18c0ff[a5_0x5947('0x2a')](...readCompletedTasks(_0x432121));}}return{'completedStatusCode':_0x377afc,'completedTasks':_0x18c0ff};}function groupByTarget(_0x7e78ae){const _0x1210c8=[];_0x7e78ae[a5_0x5947('0x57')](_0x430890=>{const _0x5794a6=_0x1210c8['find'](_0x476aa6=>_0x476aa6[a5_0x5947('0x18')]===_0x430890[a5_0x5947('0x18')]&&_0x476aa6[a5_0x5947('0x2b')]===_0x430890[a5_0x5947('0x2b')]);if(_0x5794a6){_0x5794a6[a5_0x5947('0x44')][a5_0x5947('0x2a')](_0x430890['projectName']);}else{_0x1210c8[a5_0x5947('0x2a')]({'target':_0x430890['target'],'projects':[_0x430890['projectName']],'params':_0x430890['params'],'configuration':_0x430890[a5_0x5947('0x2b')]});}});return _0x1210c8;}function getAgentName(){if(process['env']['NX_AGENT_NAME']!==undefined){return process[a5_0x5947('0x1a')][a5_0x5947('0x37')];}else if(process[a5_0x5947('0x1a')][a5_0x5947('0x39')]!==undefined){return process['env']['CIRCLE_STAGE'];}else{return'Agent\x20'+Math[a5_0x5947('0x7')](Math[a5_0x5947('0xd')]()*0x186a0);}}function createAgentLockfile(_0xb54aa0,_0x2dd63c){const _0x47c0c9=_0xb54aa0[a5_0x5947('0xc')]||'./node_modules/.cache/nx';const _0x52abe9=_0x47c0c9+a5_0x5947('0x4');const _0x4d616f=_0x52abe9+'/'+_0x2dd63c+a5_0x5947('0x13');if(!fs_1[a5_0x5947('0x1e')](_0x52abe9)){fs_1[a5_0x5947('0x40')](_0x52abe9,{'recursive':!![]});}const _0x200bab=fs_1['readdirSync'](_0x52abe9);if(_0x200bab[a5_0x5947('0x5a')]){if(_0x200bab['includes'](_0x2dd63c+a5_0x5947('0x13'))){output_1[a5_0x5947('0x27')][a5_0x5947('0x34')]({'title':a5_0x5947('0x32'),'bodyLines':[a5_0x5947('0x56'),'',a5_0x5947('0x1')]});process[a5_0x5947('0x6')](0x1);}output_1[a5_0x5947('0x27')][a5_0x5947('0x58')]({'title':'Other\x20Nx\x20Cloud\x20Agents\x20Detected','bodyLines':[a5_0x5947('0xf'),'',a5_0x5947('0x52'),a5_0x5947('0x4b')]});}fs_1[a5_0x5947('0x3b')](_0x4d616f,'');process['on']('exit',()=>cleanupAgentLockfile(_0x4d616f));process['on']('SIGINT',()=>cleanupAgentLockfile(_0x4d616f));}function cleanupAgentLockfile(_0x5c14b3){if(fs_1[a5_0x5947('0x1e')](_0x5c14b3)){fs_1[a5_0x5947('0x48')](_0x5c14b3);}}function startAgent(){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x9fa60a=environment_1[a5_0x5947('0x10')]();if(!_0x9fa60a){print_run_group_error_1[a5_0x5947('0x3e')]();return process['exit'](0x1);}output_1[a5_0x5947('0x27')][a5_0x5947('0x2d')]({'title':a5_0x5947('0x43')});const _0x4d20a5=JSON[a5_0x5947('0x14')](stripJsonComments(fs_1[a5_0x5947('0x11')]('nx.json')['toString']()))[a5_0x5947('0x35')][a5_0x5947('0x33')]['options'];const _0x2ecac8=getAgentName();createAgentLockfile(_0x4d20a5,_0x2ecac8);const _0x55f756=new distributed_agent_api_1['DistributedAgentApi'](_0x4d20a5,_0x9fa60a,_0x2ecac8);return executeTasks(_0x4d20a5,_0x55f756)['catch'](_0x5e0d64=>__awaiter(this,void 0x0,void 0x0,function*(){yield _0x55f756[a5_0x5947('0x5')](a5_0x5947('0x17')+_0x5e0d64[a5_0x5947('0x51')]+'\x22');throw _0x5e0d64;}));});}exports[a5_0x5947('0x23')]=startAgent;